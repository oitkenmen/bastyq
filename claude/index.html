<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bastyq</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial Black', sans-serif;
            background: white;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap');

        .screen {
            display: none;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Start Screen */
        #startScreen {
            justify-content: center;
            background: linear-gradient(180deg, #7EC8E3 0%, #A8D5BA 50%, #F4E87C 100%);
            position: relative;
            overflow: hidden;
        }

        .map-pattern {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0.3;
        }

        .map-blob {
            position: absolute;
            background: #6FB86F;
            border-radius: 50%;
            border: 3px solid #F4A460;
        }

        .official-box {
            background: linear-gradient(135deg, #87CEEB 0%, #6FB8E0 100%);
            border: 5px solid #2C5F7C;
            border-radius: 30px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 10;
        }

        .official-avatar {
            width: 180px;
            height: 180px;
            background: #F4C090;
            border-radius: 50%;
            border: 4px solid #2C5F7C;
            position: relative;
            margin: 0 auto;
        }

        .official-avatar::before {
            content: '';
            position: absolute;
            width: 140px;
            height: 140px;
            background: #F4C090;
            border-radius: 50%;
            top: -20px;
            left: 20px;
            border: 4px solid #2C5F7C;
        }

        .official-face {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 2;
        }

        .angry-eyes {
            position: absolute;
            top: 50px;
            left: 35px;
            display: flex;
            gap: 35px;
        }

        .angry-eye {
            width: 30px;
            height: 20px;
            background: white;
            border: 3px solid #000;
            border-radius: 50%;
            position: relative;
        }

        .angry-eye::before {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            background: #000;
            border-radius: 50%;
            top: 4px;
            left: 4px;
        }

        .angry-eye::after {
            content: '';
            position: absolute;
            width: 35px;
            height: 3px;
            background: #000;
            top: -8px;
            left: -5px;
            transform: rotate(-15deg);
        }

        .angry-eye:last-child::after {
            transform: rotate(15deg);
            left: 0;
        }

        .angry-mouth {
            position: absolute;
            top: 100px;
            left: 60px;
            width: 60px;
            height: 25px;
            border: 3px solid #000;
            border-top: none;
            border-radius: 0 0 20px 20px;
            background: #8B4513;
        }

        .suit {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 80px;
            background: #2C3E50;
            border: 3px solid #000;
            border-radius: 10px 10px 50% 50%;
            z-index: 1;
        }

        .suit::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 60px;
            background: white;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 5px;
        }

        .title {
            font-size: 80px;
            font-weight: 900;
            color: white;
            text-shadow: 5px 5px 0 #2C5F7C, -2px -2px 0 #87CEEB;
            margin-bottom: 30px;
            z-index: 10;
            letter-spacing: 5px;
        }

        .btn {
            padding: 20px 60px;
            font-size: 28px;
            font-weight: 900;
            background: white;
            color: #2C5F7C;
            border: 5px solid #2C5F7C;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 8px 0 #2C5F7C, 0 10px 20px rgba(0,0,0,0.3);
            transition: all 0.1s;
            z-index: 10;
            text-transform: uppercase;
        }

        .btn:active {
            transform: translateY(6px);
            box-shadow: 0 2px 0 #2C5F7C, 0 4px 10px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            color: #666;
            box-shadow: 0 8px 0 #999;
        }

        /* Select District Screen */
        #selectScreen {
            padding-top: 20px;
            background: linear-gradient(180deg, #7EC8E3 0%, #A8D5BA 100%);
            overflow-y: auto;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-title {
            font-family: 'Fredoka One', cursive;
            font-size: 82px;
            font-weight: 400;
            color: #FF6B35;
            text-shadow: 6px 6px 0 #FFB84D, 8px 8px 0 #2C5F7C, -3px -3px 0 #FFF;
            letter-spacing: 3px;
            margin-bottom: 15px;
            display: inline-block;
            background: linear-gradient(180deg, #FF6B35 0%, #FF8C42 50%, #FFA552 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(6px 6px 0 #FFB84D) drop-shadow(8px 8px 0 #2C5F7C);
        }

        .game-subtitle {
            font-size: 16px;
            font-weight: 700;
            color: #2C5F7C;
            background: white;
            padding: 12px 25px;
            border: 4px solid #2C5F7C;
            border-radius: 15px;
            display: inline-block;
            box-shadow: 0 4px 0 #2C5F7C;
            max-width: 90%;
            margin: 0 auto;
        }

        .instruction {
            font-size: 28px;
            font-weight: 900;
            color: white;
            text-align: center;
            margin-bottom: 25px;
            margin-top: 20px;
            text-shadow: 3px 3px 0 #2C5F7C;
        }

        .regions-list {
            max-width: 500px;
            width: 90%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding-bottom: 30px;
        }

        .region-item {
            background: linear-gradient(135deg, #6FB86F 0%, #8FBC8F 100%);
            border: 4px solid #4A7C4A;
            border-radius: 15px;
            padding: 18px 25px;
            font-size: 20px;
            font-weight: 900;
            color: white;
            text-shadow: 2px 2px 0 #2C5F7C;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 5px 0 #4A7C4A, 0 6px 15px rgba(0,0,0,0.2);
            position: relative;
        }

        .region-item:hover:not(.locked):not(.completed) {
            transform: translateY(-3px);
            box-shadow: 0 8px 0 #4A7C4A, 0 10px 20px rgba(0,0,0,0.3);
        }

        .region-item:active:not(.locked):not(.completed) {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #4A7C4A, 0 3px 10px rgba(0,0,0,0.2);
        }

        .region-item.locked {
            background: linear-gradient(135deg, #95A5A6 0%, #BDC3C7 100%);
            border-color: #7F8C8D;
            box-shadow: 0 5px 0 #7F8C8D;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .region-item.completed {
            background: linear-gradient(135deg, #5DADE2 0%, #3498DB 100%);
            border-color: #2980B9;
            box-shadow: 0 5px 0 #2980B9;
        }

        .region-item.lost {
            background: linear-gradient(135deg, #EC7063 0%, #E74C3C 100%);
            border-color: #C0392B;
            box-shadow: 0 5px 0 #C0392B;
        }

        .region-item::after {
            content: '';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
        }

        .region-item.locked::after {
            content: 'üîí';
        }

        .region-item.completed::after {
            content: '‚úÖ';
        }

        .region-item.lost::after {
            content: '‚ùå';
        }

        .kz-map {
            display: none;
        }

        /* Game Screen */
        #gameScreen {
            padding-top: 20px;
            background: linear-gradient(180deg, #7EC8E3 0%, #A8D5BA 100%);
        }

        .game-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            margin-bottom: 15px;
            max-width: 500px;
            width: 100%;
        }

        .exit-btn {
            padding: 12px 20px;
            font-size: 16px;
            font-weight: 900;
            background: white;
            color: #E74C3C;
            border: 3px solid #E74C3C;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 4px 0 #C0392B;
            transition: all 0.1s;
            text-transform: uppercase;
        }

        .exit-btn:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 #C0392B;
        }

        .region-name {
            font-size: 18px;
            font-weight: 900;
            color: white;
            text-shadow: 2px 2px 0 #2C5F7C;
            text-align: center;
            flex-grow: 1;
        }

        .score-banner {
            background: linear-gradient(135deg, #4A7C4A 0%, #6FB86F 100%);
            border: 5px solid #2C5F7C;
            border-radius: 25px;
            padding: 15px 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 0 #2C5F7C, 0 10px 30px rgba(0,0,0,0.3);
        }

        .score-title {
            font-size: 18px;
            color: white;
            text-align: center;
            margin-bottom: 10px;
            font-weight: 900;
        }

        .score {
            display: flex;
            justify-content: center;
            gap: 30px;
            align-items: center;
        }

        .score-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .score-label {
            font-size: 14px;
            color: white;
            margin-bottom: 5px;
            font-weight: 900;
        }

        .score-value {
            font-size: 36px;
            color: #2C5F7C;
            background: white;
            padding: 10px 25px;
            border-radius: 15px;
            border: 4px solid #2C5F7C;
            min-width: 80px;
            text-align: center;
            font-weight: 900;
            box-shadow: 0 4px 0 #2C5F7C;
        }

        .vs {
            font-size: 24px;
            color: white;
            font-weight: 900;
        }

        .district-map {
            display: grid;
            gap: 3px;
            margin: 20px auto;
            padding: 20px;
            max-width: 90vw;
            justify-content: center;
        }

        .pixel {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #8FBC8F 0%, #6FB86F 100%);
            border: 3px solid #4A7C4A;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 8px;
            box-shadow: 0 4px 0 #4A7C4A, inset 0 -2px 5px rgba(0,0,0,0.2);
        }

        .pixel::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            height: 15px;
            background: linear-gradient(180deg, rgba(255,255,255,0.4) 0%, transparent 100%);
            border-radius: 5px 5px 0 0;
        }

        .pixel::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: #5A9A5A;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: -10px -5px 0 #5A9A5A, 8px -3px 0 #5A9A5A, -5px 7px 0 #5A9A5A;
        }

        .pixel.city::after {
            content: 'üèõÔ∏è';
            font-size: 20px;
            width: auto;
            height: auto;
            background: none;
            box-shadow: none;
            transform: translate(-50%, -50%);
        }

        .pixel:hover:not(.claimed-user):not(.claimed-boss) {
            transform: scale(1.15) translateY(-3px);
            box-shadow: 0 6px 0 #4A7C4A, inset 0 -2px 5px rgba(0,0,0,0.2);
        }

        .pixel.selecting {
            background: linear-gradient(135deg, #F4A460 0%, #F39C12 100%) !important;
            border: 3px solid #D68910;
            box-shadow: 0 4px 0 #D68910, 0 0 15px #F39C12;
            animation: pulse 0.5s infinite;
        }

        .pixel.claimed-user {
            background: linear-gradient(135deg, #5DADE2 0%, #3498DB 100%);
            border: 3px solid #2980B9;
            box-shadow: 0 4px 0 #2980B9, inset 0 -2px 5px rgba(0,0,0,0.2);
            cursor: not-allowed;
        }

        .pixel.claimed-boss {
            background: linear-gradient(135deg, #EC7063 0%, #E74C3C 100%);
            border: 3px solid #C0392B;
            box-shadow: 0 4px 0 #C0392B, inset 0 -2px 5px rgba(0,0,0,0.2);
            cursor: not-allowed;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1.15) translateY(-3px); }
            50% { transform: scale(1.25) translateY(-5px); }
        }

        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }

        .dice-result {
            font-size: 48px;
            font-weight: 900;
            color: #2C5F7C;
            background: white;
            padding: 20px 30px;
            border: 5px solid #2C5F7C;
            border-radius: 20px;
            box-shadow: 0 6px 0 #2C5F7C;
            min-width: 100px;
            text-align: center;
        }

        .dice-result::before {
            content: 'üé≤ ';
        }

        .message {
            font-size: 22px;
            font-weight: 900;
            color: white;
            text-align: center;
            margin: 10px 0;
            text-shadow: 3px 3px 0 #2C5F7C;
        }

        .selection-counter {
            font-size: 28px;
            font-weight: 900;
            color: #2C5F7C;
            background: white;
            padding: 15px 30px;
            border: 4px solid #2C5F7C;
            border-radius: 15px;
            margin-top: 15px;
            box-shadow: 0 4px 0 #2C5F7C;
        }

        /* End Screen */
        #endScreen {
            background: linear-gradient(180deg, #7EC8E3 0%, #A8D5BA 100%);
        }

        .result {
            font-size: 56px;
            font-weight: 900;
            margin: 30px 0;
            text-shadow: 4px 4px 0 #2C5F7C;
        }

        .result.win {
            color: #27AE60;
        }

        .result.lose {
            color: #E74C3C;
        }

        .final-score {
            font-size: 32px;
            margin: 20px 0;
            color: white;
            font-weight: 900;
            text-shadow: 3px 3px 0 #2C5F7C;
        }
    </style>
</head>
<body>
    <!-- Select District Screen -->
    <div id="selectScreen" class="screen active">
        <div class="game-header">
            <div class="game-title">Bastyq</div>
            <div class="game-subtitle">A multiplayer mobile game about ambitious government official in Kazakhstan</div>
        </div>
        <div class="instruction">Select Region</div>
        <div class="regions-list" id="regionsList"></div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="screen">
        <div class="game-top-bar">
            <button class="exit-btn" onclick="exitToMenu()">‚Üê EXIT</button>
            <div class="region-name" id="regionName"></div>
        </div>
        <div class="score-banner">
            <div class="score">
                <div class="score-item">
                    <div class="score-label">USER</div>
                    <div class="score-value" id="userScore">0</div>
                </div>
                <div class="vs">VS</div>
                <div class="score-item">
                    <div class="score-label" id="opponentLabel">A.I. ZHOLDASBEKOV</div>
                    <div class="score-value" id="bossScore">0</div>
                </div>
            </div>
        </div>
        <div class="message" id="gameMessage">Your turn!</div>
        <div id="diceContainer" style="display: none;">
            <div class="dice-result" id="diceResult">?</div>
        </div>
        <div class="district-map" id="districtMap"></div>
        <div class="controls">
            <button class="btn" id="moveBtn" onclick="makeMove()">ROLL DICE</button>
            <button class="btn" id="claimBtn" onclick="claimAuthority()" disabled>CLAIM</button>
            <div class="selection-counter" id="selectionCounter" style="display: none;">
                Selected: <span id="selectedCount">0</span> / <span id="requiredCount">0</span>
            </div>
        </div>
    </div>

    <!-- End Screen -->
    <div id="endScreen" class="screen">
        <div class="result" id="resultText"></div>
        <div class="final-score" id="finalScore"></div>
        <button class="btn" onclick="backToMap()">CONTINUE</button>
    </div>

    <script>
        let selectedDistrict = null;
        let districtResults = {};
        let currentMap = [];
        let userClaimed = 0;
        let bossClaimed = 0;
        let currentDice = 0;
        let selectedPixels = [];
        let isUserTurn = true;
        let totalPixels = 0;
        let currentRegionIndex = 0;
        let opponentName = 'A.I. Zholdasbekov';

        const regions = [
            'Abai Region',
            'Aqtobe Region',
            'Atyrau Region',
            'East Kazakhstan Region',
            'Jambyl Region',
            'Jetisu Region',
            'Karaganda Region',
            'Kostanay Region',
            'Kyzylorda Region',
            'Mangystau Region',
            'North Kazakhstan Region',
            'Pavlodar Region',
            'Turkistan Region',
            'West Kazakhstan Region',
            'Ulytau Region',
            'Aqmola Region',
            'Almaty Region',
            'Baikonur',
            'Shymkent',
            'Almaty',
            'Astana'
        ];

        // Load progress from storage
        let regionStatuses = {};
        
        // Create animated background blobs
        function createMapPattern() {
            // Not needed anymore
        }

        // Initialize the game on load
        createRegionsList();

        function createRegionsList() {
            const container = document.getElementById('regionsList');
            container.innerHTML = '';
            
            regions.forEach((region, index) => {
                const item = document.createElement('div');
                item.className = 'region-item';
                item.textContent = region;
                
                const status = regionStatuses[index];
                
                if (index > currentRegionIndex) {
                    // Locked
                    item.classList.add('locked');
                } else if (status === 'won') {
                    item.classList.add('completed');
                } else if (status === 'lost') {
                    item.classList.add('lost');
                }
                
                if (index <= currentRegionIndex && !status) {
                    item.onclick = () => selectRegion(index);
                }
                
                container.appendChild(item);
            });
        }

        function selectRegion(index) {
            selectedDistrict = index;
            
            // Set opponent name based on region
            if (index === regions.length - 1) {
                opponentName = 'Final Super Boss';
            } else {
                opponentName = 'A.I. Zholdasbekov';
            }
            
            startRound();
        }

        function startRound() {
            showScreen('gameScreen');
            document.getElementById('regionName').textContent = regions[selectedDistrict];
            document.getElementById('opponentLabel').textContent = opponentName.toUpperCase();
            generateDistrictMap();
            resetGame();
        }

        function exitToMenu() {
            showScreen('selectScreen');
            createRegionsList();
            // Reset game state
            currentDice = 0;
            selectedPixels = [];
            document.getElementById('moveBtn').disabled = false;
            document.getElementById('claimBtn').disabled = true;
            document.getElementById('selectionCounter').style.display = 'none';
            document.getElementById('diceContainer').style.display = 'none';
        }

        function generateDistrictMap() {
            const container = document.getElementById('districtMap');
            container.innerHTML = '';
            
            currentMap = [];
            totalPixels = 0;
            
            // Generate random organic shape in a grid
            const gridSize = 10;
            container.style.gridTemplateColumns = `repeat(${gridSize}, 45px)`;
            
            // Create center point
            const centerR = Math.floor(gridSize / 2);
            const centerC = Math.floor(gridSize / 2);
            
            // Generate organic shape using random walk
            const pixels = new Set();
            pixels.add(`${centerR},${centerC}`);
            
            // Grow the shape
            const targetSize = 35 + Math.floor(Math.random() * 20);
            while (pixels.size < targetSize) {
                const pixelArray = Array.from(pixels);
                const randomPixel = pixelArray[Math.floor(Math.random() * pixelArray.length)];
                const [r, c] = randomPixel.split(',').map(Number);
                
                // Add adjacent pixel
                const directions = [[-1,0], [1,0], [0,-1], [0,1]];
                const dir = directions[Math.floor(Math.random() * directions.length)];
                const newR = r + dir[0];
                const newC = c + dir[1];
                
                if (newR >= 0 && newR < gridSize && newC >= 0 && newC < gridSize) {
                    pixels.add(`${newR},${newC}`);
                }
            }
            
            // Create grid
            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    if (pixels.has(`${r},${c}`)) {
                        const pixel = document.createElement('div');
                        pixel.className = 'pixel';
                        
                        // 10% chance of city
                        if (Math.random() < 0.1) {
                            pixel.classList.add('city');
                        }
                        
                        pixel.dataset.row = r;
                        pixel.dataset.col = c;
                        pixel.onclick = () => selectPixel(pixel);
                        container.appendChild(pixel);
                        
                        currentMap.push({ element: pixel, owner: null, r, c });
                        totalPixels++;
                    } else {
                        // Empty space
                        const empty = document.createElement('div');
                        empty.style.width = '45px';
                        empty.style.height = '45px';
                        container.appendChild(empty);
                    }
                }
            }
        }

        function resetGame() {
            userClaimed = 0;
            bossClaimed = 0;
            updateScore();
            isUserTurn = true;
            document.getElementById('gameMessage').textContent = 'Your turn!';
            document.getElementById('moveBtn').disabled = false;
            document.getElementById('claimBtn').disabled = true;
            document.getElementById('diceContainer').style.display = 'none';
        }

        function makeMove() {
            const availablePixels = currentMap.filter(p => !p.owner).length;
            currentDice = Math.floor(Math.random() * 6) + 1;
            
            // If fewer pixels left than dice roll, adjust
            const pixelsToSelect = Math.min(currentDice, availablePixels);
            
            document.getElementById('diceResult').textContent = currentDice;
            document.getElementById('diceContainer').style.display = 'block';
            document.getElementById('gameMessage').textContent = `Select ${pixelsToSelect} pixel${pixelsToSelect !== 1 ? 's' : ''}!`;
            document.getElementById('moveBtn').disabled = true;
            document.getElementById('selectionCounter').style.display = 'block';
            document.getElementById('requiredCount').textContent = pixelsToSelect;
            document.getElementById('selectedCount').textContent = '0';
            selectedPixels = [];
            
            // Store the actual number to select
            currentDice = pixelsToSelect;
        }

        function selectPixel(element) {
            if (!isUserTurn || currentDice === 0) return;
            
            const pixel = currentMap.find(p => p.element === element);
            if (!pixel || pixel.owner) return;
            
            const index = selectedPixels.findIndex(p => p.element === element);
            
            if (index >= 0) {
                selectedPixels.splice(index, 1);
                element.classList.remove('selecting');
            } else if (selectedPixels.length < currentDice) {
                selectedPixels.push(pixel);
                element.classList.add('selecting');
            }
            
            document.getElementById('selectedCount').textContent = selectedPixels.length;
            document.getElementById('claimBtn').disabled = selectedPixels.length !== currentDice;
        }

        function claimAuthority() {
            selectedPixels.forEach(p => {
                p.owner = 'user';
                p.element.classList.remove('selecting');
                p.element.classList.add('claimed-user');
                userClaimed++;
            });
            
            updateScore();
            selectedPixels = [];
            currentDice = 0;
            document.getElementById('claimBtn').disabled = true;
            document.getElementById('selectionCounter').style.display = 'none';
            
            if (checkGameEnd()) return;
            
            isUserTurn = false;
            document.getElementById('gameMessage').textContent = `${opponentName} makes a turn...`;
            setTimeout(bossTurn, 1000);
        }

        function bossTurn() {
            const available = currentMap.filter(p => !p.owner);
            const dice = Math.floor(Math.random() * 6) + 1;
            const pixelsToSelect = Math.min(dice, available.length);
            
            document.getElementById('diceResult').textContent = dice;
            document.getElementById('gameMessage').textContent = `${opponentName} rolled ${dice}!`;
            
            setTimeout(() => {
                const bossPixels = [];
                
                for (let i = 0; i < pixelsToSelect; i++) {
                    if (available.length > 0) {
                        const randomIndex = Math.floor(Math.random() * available.length);
                        const pixel = available[randomIndex];
                        bossPixels.push(pixel);
                        available.splice(randomIndex, 1);
                    }
                }
                
                bossPixels.forEach((p, i) => {
                    setTimeout(() => {
                        p.owner = 'boss';
                        p.element.classList.add('claimed-boss');
                        bossClaimed++;
                        updateScore();
                    }, i * 200);
                });
                
                setTimeout(() => {
                    if (!checkGameEnd()) {
                        isUserTurn = true;
                        document.getElementById('gameMessage').textContent = 'Your turn!';
                        document.getElementById('moveBtn').disabled = false;
                        document.getElementById('diceContainer').style.display = 'none';
                    }
                }, bossPixels.length * 200 + 500);
            }, 1000);
        }

        function updateScore() {
            document.getElementById('userScore').textContent = userClaimed;
            document.getElementById('bossScore').textContent = bossClaimed;
        }

        function checkGameEnd() {
            if (userClaimed + bossClaimed >= totalPixels) {
                setTimeout(() => {
                    const won = userClaimed > bossClaimed;
                    
                    // Update region status
                    if (won) {
                        regionStatuses[selectedDistrict] = 'won';
                        // Unlock next region
                        if (selectedDistrict === currentRegionIndex && currentRegionIndex < regions.length - 1) {
                            currentRegionIndex++;
                        }
                    } else {
                        regionStatuses[selectedDistrict] = 'lost';
                    }
                    
                    document.getElementById('resultText').textContent = won ? 'YOU WIN! üéâ' : 'BOSS WINS! üò§';
                    document.getElementById('resultText').className = won ? 'result win' : 'result lose';
                    document.getElementById('finalScore').textContent = `Final Score: ${userClaimed} - ${bossClaimed}`;
                    
                    showScreen('endScreen');
                }, 500);
                return true;
            }
            return false;
        }

        function backToMap() {
            showScreen('selectScreen');
            createRegionsList();
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }
    </script>
</body>
</html>