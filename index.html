<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bastyq</title>
<style>
  body {
    margin: 0;
    font-family: "Trebuchet MS", sans-serif;
    text-align: center;
    color: #fff;
    background: linear-gradient(145deg, #a3de83 0%, #4cb5ae 100%);
  }

  h1 {
    margin: 10px 0 0 0;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }

  #leaderboard {
    margin: 8px 0 12px 0;
    font-size: 18px;
  }

  #mainMenu, #gamePage {
    display: none;
  }

  #kazMap {
    display: grid;
    grid-template-columns: repeat(20, 22px);
    grid-template-rows: repeat(12, 22px);
    justify-content: center;
    gap: 2px;
    margin: 20px auto;
  }

  .district {
    width: 22px;
    height: 22px;
    border-radius: 4px;
    background: #777;
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.3);
    cursor: pointer;
    visibility: hidden;
  }

  .land {
    visibility: visible;
  }

  .district.user {
    background: #2ecc71;
  }

  .district.computer {
    background: #e74c3c;
  }

  .district.selected {
    outline: 2px solid yellow;
  }

  #startBtn {
    font-size: 18px;
    padding: 8px 20px;
    margin-top: 10px;
    border: none;
    border-radius: 8px;
    background: #fff;
    color: #333;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(0,0,0,0.3);
  }

  /* Game page */
  #map {
    display: grid;
    grid-template-columns: repeat(20, 24px);
    grid-template-rows: repeat(12, 24px);
    gap: 3px;
    justify-content: center;
    margin: 25px auto;
  }

  .pixel {
    width: 24px;
    height: 24px;
    border-radius: 6px;
    background: #2f2f2f;
    visibility: hidden;
    cursor: pointer;
  }

  .land {
    visibility: visible;
    background: linear-gradient(145deg, #7cc47f, #4f9c64);
    border: 1px solid rgba(255,255,255,0.15);
  }

  .user {
    background: linear-gradient(145deg, #3ddc84, #25b56b);
  }

  .computer {
    background: linear-gradient(145deg, #ff6b6b, #d94141);
  }

  .selected {
    outline: 2px solid yellow;
  }

  #controls button {
    font-size: 18px;
    margin: 5px;
    padding: 8px 18px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    background: #fff;
    color: #333;
    box-shadow: 0 3px 6px rgba(0,0,0,0.3);
  }

  #score, #status {
    font-size: 18px;
    margin: 5px 0;
  }

  #result {
    font-size: 20px;
    margin-top: 10px;
  }
</style>
</head>
<body>
  <h1>Bastyq</h1>
  <div id="leaderboard">User: 0 | Computer: 0</div>

  <!-- Main Menu -->
  <div id="mainMenu">
    <p>Select a district to conquer:</p>
    <div id="kazMap"></div>
    <button id="startBtn" disabled>Start</button>
  </div>

  <!-- Game Page -->
  <div id="gamePage">
    <div id="score">User: 0 | Computer: 0</div>
    <div id="status"></div>
    <div id="map"></div>
    <div id="controls">
      <button id="roll">ðŸŽ² Roll Dice</button>
      <button id="claim" style="display:none;">Claim</button>
      <button id="restart" style="display:none;">Return</button>
    </div>
    <div id="result"></div>
  </div>

<script>
/* Elements */
const mainMenu = document.getElementById("mainMenu");
const kazMapEl = document.getElementById("kazMap");
const startBtn = document.getElementById("startBtn");
const leaderboardEl = document.getElementById("leaderboard");

const gamePage = document.getElementById("gamePage");
const mapEl = document.getElementById("map");
const rollBtn = document.getElementById("roll");
const claimBtn = document.getElementById("claim");
const restartBtn = document.getElementById("restart");
const resultEl = document.getElementById("result");
const scoreEl = document.getElementById("score");
const statusEl = document.getElementById("status");

/* Game Data */
let kazDistricts = [];
let selectedDistrict = null;
let districtOwnership = []; // 0 neutral, 1 user, 2 computer
let pixels = [];
let rolledNumber = 0;
let selected = [];
let userScore = 0;
let compScore = 0;

/* Leaderboard */
function updateLeaderboard() {
  const userCount = districtOwnership.filter(x => x === 1).length;
  const compCount = districtOwnership.filter(x => x === 2).length;
  leaderboardEl.textContent = `User: ${userCount} | Computer: ${compCount}`;
}

/* Create Kazakhstan map (roughly shaped) */
function createKazakhstanMap() {
  kazMapEl.innerHTML = "";
  kazDistricts = [];

  const shape = [
    "....................",
    ".....#####..........",
    "....#########.......",
    "...###########......",
    "...###########......",
    "....##########......",
    ".....#########......",
    "......######........",
    ".......#####........",
    ".........###........",
    "..........##........",
    "...................."
  ];

  districtOwnership = districtOwnership.length ? districtOwnership : [];

  for (let r = 0; r < shape.length; r++) {
    for (let c = 0; c < shape[r].length; c++) {
      const idx = r * shape[r].length + c;
      const div = document.createElement("div");
      div.className = "district";
      kazMapEl.appendChild(div);
      kazDistricts.push(div);

      if (shape[r][c] === "#") {
        div.classList.add("land");
        if (!districtOwnership[idx]) districtOwnership[idx] = 0;
        if (districtOwnership[idx] === 1) div.classList.add("user");
        if (districtOwnership[idx] === 2) div.classList.add("computer");

        div.addEventListener("click", () => {
          if (districtOwnership[idx] === 0) {
            kazDistricts.forEach(d => d.classList.remove("selected"));
            div.classList.add("selected");
            selectedDistrict = idx;
            startBtn.disabled = false;
          }
        });
      } else {
        districtOwnership[idx] = -1; // non-land
      }
    }
  }
  updateLeaderboard();
}

/* Local Game Map */
function createRandomMap() {
  mapEl.innerHTML = "";
  pixels = [];
  const rows = 12, cols = 20;
  for (let i = 0; i < rows * cols; i++) {
    const div = document.createElement("div");
    div.className = "pixel";
    mapEl.appendChild(div);
    pixels.push(div);
  }

  const start = Math.floor(Math.random() * pixels.length);
  const visited = new Set([start]);
  let frontier = [start];
  const target = 120 + Math.floor(Math.random() * 40);
  while (visited.size < target && frontier.length > 0) {
    const current = frontier.pop();
    const neighbors = [current - 1, current + 1, current - cols, current + cols]
      .filter(n => n >= 0 && n < pixels.length);
    for (let n of neighbors) {
      if (!visited.has(n) && Math.random() < 0.5) {
        visited.add(n);
        frontier.push(n);
      }
    }
  }
  for (let i of visited) pixels[i].classList.add("land");

  pixels.forEach(div => {
    div.addEventListener("click", () => {
      if (
        rolledNumber > 0 &&
        div.classList.contains("land") &&
        !div.classList.contains("user") &&
        !div.classList.contains("computer")
      ) {
        if (div.classList.contains("selected")) {
          div.classList.remove("selected");
          selected = selected.filter(p => p !== div);
        } else if (selected.length < rolledNumber) {
          div.classList.add("selected");
          selected.push(div);
        }
        claimBtn.style.display = selected.length === rolledNumber ? "inline-block" : "none";
      }
    });
  });
}

/* Game Functions */
function rollDice() {
  rolledNumber = Math.floor(Math.random() * 6) + 1;
  rollBtn.textContent = `ðŸŽ² Rolled ${rolledNumber}`;
}

function claimTerritory() {
  selected.forEach(p => {
    p.classList.remove("selected");
    p.classList.add("user");
  });
  userScore += selected.length;
  selected = [];
  claimBtn.style.display = "none";
  rolledNumber = 0;
  rollBtn.textContent = "ðŸŽ² Roll Dice";
  updateScore();
  setTimeout(() => computerTurn(), 500);
}

function updateScore() {
  scoreEl.textContent = `User: ${userScore} | Computer: ${compScore}`;
}

function computerTurn() {
  const available = pixels.filter(p => p.classList.contains("land") && !p.classList.contains("user") && !p.classList.contains("computer"));
  if (available.length === 0) return checkEnd();

  const number = Math.floor(Math.random() * 6) + 1;
  statusEl.textContent = `Computer is moving... (rolled ${number})`;
  rollBtn.disabled = true;
  setTimeout(() => {
    const choices = available.sort(() => 0.5 - Math.random()).slice(0, number);
    choices.forEach(p => p.classList.add("computer"));
    compScore += choices.length;
    updateScore();
    rollBtn.disabled = false;
    statusEl.textContent = "";
    checkEnd();
  }, 2000);
}

function checkEnd() {
  const available = pixels.filter(p => p.classList.contains("land") && !p.classList.contains("user") && !p.classList.contains("computer"));
  if (available.length === 0) {
    rollBtn.style.display = "none";
    claimBtn.style.display = "none";
    restartBtn.style.display = "inline-block";
    if (userScore > compScore) {
      resultEl.textContent = `You win! (${userScore} vs ${compScore})`;
      districtOwnership[selectedDistrict] = 1;
    } else if (userScore < compScore) {
      resultEl.textContent = `Computer wins! (${compScore} vs ${userScore})`;
      districtOwnership[selectedDistrict] = 2;
    } else {
      resultEl.textContent = `It's a tie!`;
    }
  }
}

/* Restart -> Back to map */
function restart() {
  mainMenu.style.display = "block";
  gamePage.style.display = "none";
  createKazakhstanMap();
}

/* Event Listeners */
rollBtn.addEventListener("click", rollDice);
claimBtn.addEventListener("click", claimTerritory);
restartBtn.addEventListener("click", restart);

startBtn.addEventListener("click", () => {
  mainMenu.style.display = "none";
  gamePage.style.display = "block";
  startBtn.disabled = true;
  selected = [];
  rolledNumber = 0;
  userScore = 0;
  compScore = 0;
  rollBtn.textContent = "ðŸŽ² Roll Dice";
  rollBtn.style.display = "inline-block";
  claimBtn.style.display = "none";
  restartBtn.style.display = "none";
  resultEl.textContent = "";
  createRandomMap();
  updateScore();
});

/* Initialize */
mainMenu.style.display = "block";
createKazakhstanMap();
</script>
</body>
</html>
